<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Moon POS</title>
    <style>
        /* ===== BI·∫æN M√ÄU S·∫ÆC ===== */
        :root {
            --primary: #d35400;   /* Cam - ƒêang ph·ª•c v·ª• */
            --secondary: #27ae60; /* Xanh - ƒê√£ xong */
            --bg: #f0f2f5;
        }

        /* ===== C·∫§U TR√öC CH√çNH ===== */
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding: 10px; 
            user-select: none;
        }

        h1 { 
            text-align: center; 
            font-size: 1.2rem; 
            color: var(--primary); 
            margin: 10px 0; 
            text-transform: uppercase; 
        }

        /* ===== DANH S√ÅCH B√ÄN ===== */
        .tables-list { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            margin-bottom: 20px; 
        }

        .table-card {
            background: white; 
            border-radius: 12px; 
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 8px solid #ccc; 
            display: flex; 
            flex-direction: column; 
            position: relative;
        }

        /* Tr·∫°ng th√°i b√†n */
        .table-card.active { border-left-color: var(--primary); } 
        .table-card.done { border-left-color: var(--secondary); background-color: #f9fff9; }

        .table-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid #eee; 
            padding-bottom: 8px; 
            margin-bottom: 8px;
        }

        .table-info { 
            display: flex; 
            flex-direction: column; 
        }
        .table-name { 
            font-weight: bold; 
            font-size: 1.1rem; 
        }
        .table-status { 
            font-size: 0.8rem; 
            color: #888; 
            font-weight: normal;
        }
        .active .table-status { color: var(--primary); font-weight: bold; }
        .done .table-status { color: var(--secondary); font-weight: bold; }

        /* N√∫t h√†nh ƒë·ªông */
        .action-group { 
            display: flex; 
            gap: 8px; 
        }
        .btn-action {
            width: 32px; 
            height: 32px; 
            border: none; 
            border-radius: 50%;
            font-size: 1rem; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-trash { background: #fee; color: #c0392b; }
        .btn-check { background: #e8f8f5; color: #ccc; }
        .done .btn-check { background: var(--secondary); color: white; }

        /* Hi·ªÉn th·ªã m√≥n ƒÉn */
        .items-display { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 5px; 
        }
        .item-tag {
            background: #f8f9fa; 
            border: 1px solid #ddd; 
            padding: 4px 8px;
            border-radius: 6px; 
            font-size: 0.85rem; 
            color: #333;
        }
        .item-tag b { 
            color: var(--primary); 
            margin-left: 4px; 
        }
        .total-row { 
            text-align: right; 
            margin-top: 10px; 
            font-weight: bold; 
            color: #e74c3c; 
            font-size: 1.1rem; 
        }

        /* ===== MODAL ƒê·∫∂T M√ìN ===== */
        #order-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            z-index: 1000; 
            flex-direction: column; 
        }

        /* Header modal */
        .modal-header { 
            padding: 10px 15px; /* Gi·∫£m padding */
            border-bottom: 1px solid #ddd; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #fff; 
        }

        /* Body modal */
        .modal-body { 
            display: flex; 
            flex-direction: column; 
            flex-grow: 1; 
            overflow: hidden; 
        }

        /* Khu v·ª±c bill - ƒê√É TƒÇNG K√çCH TH∆Ø·ªöC */
        .bill-area { 
            height: 55%; /* TƒÉng t·ª´ 35% l√™n 55% */
            background: #f8f9fa; 
            overflow-y: auto; 
            padding: 10px; 
            border-bottom: 2px solid #ddd; 
        }

        /* Bill item */
        .bill-item { 
            display: grid; 
            grid-template-columns: 1fr auto auto; 
            align-items: center; 
            gap: 10px;
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
            font-size: 0.9rem; 
        }
        .bill-name-group { 
            display: flex; 
            flex-direction: column; 
        }
        .bill-control {
            display: flex; 
            align-items: center; 
            gap: 4px;
            background: #fff; 
            border-radius: 20px; 
            border: 1px solid #ddd; 
            padding: 2px;
        }
        .btn-qty {
            width: 26px; 
            height: 26px;
            border-radius: 50%; 
            border: none; 
            background: #f0f2f5;
            color: var(--primary); 
            font-weight: bold; 
            font-size: 1.1rem;
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        .btn-qty:active { background: #e0e0e0; }
        .qty-num { 
            font-weight: bold; 
            padding: 0 8px; 
            min-width: 15px; 
            text-align: center; 
            font-size: 1rem;
        }

        /* ===== MENU TABS - ƒê√É THU NH·ªé ===== */
        .menu-tabs { 
            display: flex; 
            width: 100%;
            padding: 4px 2px; /* Gi·∫£m padding */
            background: #fff; 
            box-sizing: border-box;
            border-bottom: 1px solid #eee;
        }
        .tab { 
            flex: 1; 
            text-align: center;
            padding: 6px 2px; /* Gi·∫£m padding */
            margin: 0 2px;
            border-radius: 6px; 
            background: #f0f0f0;
            color: #666;
            font-size: 0.75rem; 
            font-weight: 600;
            white-space: nowrap; 
            overflow: hidden;    
            text-overflow: ellipsis; 
            border: 1px solid transparent;
        }
        .tab.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 2px 4px rgba(211, 84, 0, 0.3);
        }

        /* ===== MENU GRID - ƒê√É THU NH·ªé HI·ªÇN TH·ªä ===== */
        .menu-grid { 
            flex-grow: 1; 
            overflow-y: auto; 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 1px; /* Gi·∫£m gap */
            padding: 1px; 
        }
        .food-item { 
            background: white; 
            border: 1px solid #eee; 
            padding: 8px; /* Gi·∫£m padding item */
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
        }
        .food-name { 
            font-size: 0.8rem; /* Gi·∫£m font ch·ªØ */
            font-weight: bold; 
            display: block; 
            margin-bottom: 2px; 
        }
        .food-price { 
            color: var(--secondary); 
            font-size: 0.75rem; 
        }

        /* ===== FOOTER MODAL - ƒê√É THU NH·ªé ===== */
        .footer { 
            padding: 8px 10px; /* Gi·∫£m padding footer */
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            border-top: 1px solid #eee; 
        }
        .btn { 
            padding: 10px; /* Gi·∫£m k√≠ch th∆∞·ªõc n√∫t */
            border: none; 
            border-radius: 6px; 
            font-weight: bold; 
            font-size: 0.95rem; 
        }
        .btn-pay { 
            background: var(--secondary); 
            color: white; 
        }
        .btn-close { 
            background: #eee; 
        }
    </style>
</head>
<body>

    <h1>üåô TI·ªÜM NH√Ä MOON</h1>
    
    <div class="tables-list" id="tables-list"></div>

    <div id="order-modal">
        <div class="modal-header">
            <span id="modal-title" style="font-weight:bold">B√†n X</span>
            <span id="modal-total" style="color:red; font-weight:bold; font-size:1.1rem">0ƒë</span>
        </div>
        
        <div class="modal-body">
            <div class="bill-area" id="bill-area"></div>
            <div class="menu-tabs" id="menu-tabs"></div>
            <div class="menu-grid" id="menu-grid"></div>
        </div>
        
        <div class="footer">
            <button class="btn btn-close" onclick="closeModal()">ƒê√ìNG</button>
            <button class="btn btn-pay" onclick="payTable()">THANH TO√ÅN</button>
        </div>
    </div>

    <script>
        // ===== D·ªÆ LI·ªÜU MENU =====
        const menuData = {
            "B√°nh Canh": [ 
                { name: "B√°nh canh c√° l√≥c", price: 35000 }, 
                { name: "B√°nh canh t√¥m th·ªãt", price: 35000 }, 
                { name: "BC c√° l√≥c + m·ªçc", price: 40000 }, 
                { name: "BC t√¥m th·ªãt + m·ªçc", price: 40000 }, 
                { name: "B√°nh canh ƒë·∫∑c bi·ªát", price: 50000 }, 
                { name: "B√°nh canh th√™m", price: 8000 }, 
                { name: "Qu·∫©y (3 c√°i)", price: 5000 } 
            ],
            "C∆°m": [ 
                { name: "C∆°m g√† x·ªëi m·ª°", price: 35000 }, 
                { name: "C∆°m g√† x√©", price: 35000 }, 
                { name: "C∆°m g√† XM + tr·ª©ng", price: 40000 }, 
                { name: "C∆°m g√† x√© + tr·ª©ng", price: 40000 }, 
                { name: "C∆°m g√† XM+x√©+tr·ª©ng", price: 50000 }, 
                { name: "C∆°m chi√™n tr·ª©ng th√™m", price: 8000 } 
            ],
            "B√∫n B√≤": [ 
                { name: "B√∫n b√≤ Hu·∫ø ko m√≥ng", price: 29000 }, 
                { name: "B√∫n m√≥ng gi√≤ m·ªçc", price: 29000 }, 
                { name: "B√∫n b√≤ Hu·∫ø ƒë·∫ßy ƒë·ªß", price: 35000 }, 
                { name: "B√∫n b√≤ Hu·∫ø ƒë·∫∑c bi·ªát", price: 40000 }, 
                { name: "B√∫n th√™m", price: 5000 }, 
                { name: "Qu·∫©y (3 c√°i)", price: 5000 } 
            ],
            "M√¨ Qu·∫£ng": [ 
                { name: "M√¨ Qu·∫£ng truy·ªÅn th·ªëng", price: 25000 }, 
                { name: "M√¨ Qu·∫£ng t√¥m th·ªãt", price: 35000 }, 
                { name: "M√¨ Qu·∫£ng g√†", price: 35000 }, 
                { name: "M√¨ Qu·∫£ng th·∫≠p c·∫©m", price: 40000 }, 
                { name: "M√¨ th√™m", price: 5000 }, 
                { name: "B√°nh ƒëa th√™m", price: 5000 } 
            ],
            "ƒê·ªì U·ªëng": [ 
                { name: "Tr√† qu·∫•t ly KL", price: 12000 }, 
                { name: "Tr√† chanh ly KL", price: 12000 }, 
                { name: "Tr√† qu·∫•t nha ƒëam KL", price: 15000 }, 
                { name: "Tr√† chanh nha ƒëam KL", price: 15000 }, 
                { name: "Tr√† ƒë√†o nha ƒëam", price: 20000 }, 
                { name: "Tr√† v·∫£i nha ƒëam", price: 20000 }, 
                { name: "Tr√† ƒë√†o nha ƒëam KL", price: 30000 }, 
                { name: "Tr√† v·∫£i nha ƒëam KL", price: 30000 }, 
                { name: "S·ªØa chua ƒë√°nh ƒë√°", price: 17000 }, 
                { name: "S·ªØa chua nha ƒëam", price: 20000 } 
            ]
        };

        // ===== BI·∫æN TO√ÄN C·ª§C =====
        let currentTable = null;
        let currentCat = "B√°nh Canh";
        let orders = JSON.parse(localStorage.getItem('moonNewMenuPOS')) || {};
        let doneStatus = JSON.parse(localStorage.getItem('moonDoneStatus')) || {};

        // ===== KH·ªûI T·∫†O ·ª®NG D·ª§NG =====
        (function init() {
            checkDataCompatibility();
            renderAll();
        })();

        // ===== H√ÄM X·ª¨ L√ù DANH S√ÅCH B√ÄN =====
        function renderAll() {
            const list = document.getElementById('tables-list');
            list.innerHTML = '';
            
            for (let i = 1; i <= 6; i++) {
                const items = orders[i] || [];
                const isActive = items.length > 0;
                const isDone = doneStatus[i] === true;
                
                let cardClass = '';
                let statusText = 'TR·ªêNG';
                
                if (isActive) {
                    if (isDone) {
                        cardClass = 'active done';
                        statusText = 'ƒê√É XONG';
                    } else {
                        cardClass = 'active';
                        statusText = 'ƒêANG PH·ª§C V·ª§';
                    }
                }

                const total = items.reduce((sum, item) => sum + (item.price * item.count), 0);

                const card = document.createElement('div');
                card.className = `table-card ${cardClass}`;
                
                const buttonsHtml = isActive ? `
                    <div class="action-group">
                        <button class="btn-action btn-trash" onclick="quickDelete(event, ${i})">üóëÔ∏è</button>
                        <button class="btn-action btn-check" onclick="toggleDone(event, ${i})">‚úÖ</button>
                    </div>
                ` : '';

                card.innerHTML = `
                    <div class="table-header">
                        <div class="table-info">
                            <span class="table-name">B√ÄN ${i}</span>
                            <span class="table-status">${statusText}</span>
                        </div>
                        ${buttonsHtml}
                    </div>
                    
                    <div class="items-display">
                        ${isActive ? items.map(item => `
                            <div class="item-tag">${item.name} <b>x${item.count}</b></div>
                        `).join('') : '<span style="color:#ccc">Ch·∫°m ƒë·ªÉ g·ªçi m√≥n</span>'}
                    </div>
                    ${isActive ? `<div class="total-row">T·ªïng: ${total.toLocaleString()}ƒë</div>` : ''}
                `;
                
                card.onclick = () => openOrder(i);
                list.appendChild(card);
            }
        }

        function toggleDone(e, id) {
            e.stopPropagation();
            if (!orders[id]) return;
            
            if (doneStatus[id]) {
                delete doneStatus[id];
            } else {
                doneStatus[id] = true;
            }
            save();
        }

        function quickDelete(e, id) {
            e.stopPropagation();
            if (confirm(`X√≥a s·∫°ch m√≥n B√†n ${id}?`)) {
                delete orders[id];
                delete doneStatus[id];
                save();
            }
        }

        // ===== H√ÄM X·ª¨ L√ù MODAL =====
        function openOrder(id) {
            currentTable = id;
            document.getElementById('modal-title').innerText = `B√†n s·ªë ${id}`;
            document.getElementById('order-modal').style.display = 'flex';
            renderBill();
            renderTabs();
            renderMenu();
        }

        function renderTabs() {
            document.getElementById('menu-tabs').innerHTML = Object.keys(menuData).map(cat => `
                <div class="tab ${cat === currentCat ? 'active' : ''}" onclick="setCat('${cat}')">${cat}</div>
            `).join('');
        }

        function setCat(cat) {
            currentCat = cat;
            renderTabs();
            renderMenu();
        }

        function renderMenu() {
            document.getElementById('menu-grid').innerHTML = menuData[currentCat].map(item => `
                <div class="food-item" onclick="addDish('${item.name}', ${item.price})">
                    <span class="food-name">${item.name}</span>
                    <span class="food-price">${item.price.toLocaleString()}ƒë</span>
                </div>
            `).join('');
        }

        function addDish(name, price) {
            if (!orders[currentTable]) {
                orders[currentTable] = [];
            }
            
            let existingItem = orders[currentTable].find(i => i.name === name);
            if (existingItem) {
                existingItem.count++;
            } else {
                orders[currentTable].push({ name: name, price: price, count: 1 });
            }
            
            if (doneStatus[currentTable]) {
                delete doneStatus[currentTable];
            }
            save();
        }

        function renderBill() {
            const items = orders[currentTable] || [];
            document.getElementById('bill-area').innerHTML = items.map((o, idx) => `
                <div class="bill-item">
                    <div class="bill-name-group">
                        <span style="font-weight:bold">${o.name}</span>
                        <span style="font-size:0.8rem; color:#888">${o.price.toLocaleString()}ƒë</span>
                    </div>
                    
                    <span style="font-weight:bold; color:var(--primary)">
                        ${(o.price * o.count).toLocaleString()}ƒë
                    </span>

                    <div class="bill-control">
                        <button class="btn-qty" onclick="changeQty(${idx}, -1)">-</button>
                        <span class="qty-num">${o.count}</span>
                        <button class="btn-qty" onclick="changeQty(${idx}, 1)">+</button>
                    </div>
                </div>
            `).join('');
            
            const total = items.reduce((s, i) => s + (i.price * i.count), 0);
            document.getElementById('modal-total').innerText = total.toLocaleString() + 'ƒë';
        }

        function changeQty(index, delta) {
            let item = orders[currentTable][index];
            item.count += delta;
            
            if (item.count <= 0) {
                orders[currentTable].splice(index, 1);
                if (orders[currentTable].length === 0) {
                    delete orders[currentTable];
                    delete doneStatus[currentTable];
                }
            }
            save();
        }

        function payTable() {
            if (!orders[currentTable]) return;
            
            if (confirm("Thanh to√°n b√†n n√†y?")) {
                delete orders[currentTable];
                delete doneStatus[currentTable];
                save();
                closeModal();
            }
        }

        function closeModal() {
            document.getElementById('order-modal').style.display = 'none';
        }

        // ===== H√ÄM TI·ªÜN √çCH =====
        function save() {
            localStorage.setItem('moonNewMenuPOS', JSON.stringify(orders));
            localStorage.setItem('moonDoneStatus', JSON.stringify(doneStatus));
            renderBill();
            renderAll();
        }

        function checkDataCompatibility() {
            try {
                Object.values(orders).forEach(items => {
                    items.forEach(item => {
                        if (typeof item.count === 'undefined') throw new Error();
                    });
                });
            } catch (e) {
                console.log("Resetting old data...");
                localStorage.removeItem('moonNewMenuPOS');
                orders = {};
            }
        }
    </script>
</body>
</html>






